var Button = function(config) //button contructor
{
    this.x = config.x || 0;
    this.y = config.y || 0;
    this.width = config.width || 50;
    this.height = config.height || 50;
    this.butText = config.butText;
    this.color = config.color || color(255, 255, 255);
    this.onClick = config.onClick || function() {};
};
Button.prototype.draw = function() //button draw function
{
    rectMode(LEFT);
    fill(this.color);
    rect(this.x, this.y, this.width, this.height, 5);
    fill(0, 0, 0);
    textSize(26);
    textAlign(CENTER, TOP);
    text(this.butText, this.x+50, this.y+(this.height/2)-12);
};
Button.prototype.isMouseInside = function() //determines if the mouse is over a button
{
    return mouseX > this.x &&
           mouseX < (this.x + this.width) &&
           mouseY > this.y &&
           mouseY < (this.y + this.height);
};
Button.prototype.handleMouseClick = function() 
/* checks isMouseInside if yes, runs the onClick function */
{
    if (this.isMouseInside()) 
    {
        this.onClick();
    }
};

var a = 0;// numbers shown on the screen
var b = 0;// num 2 in calculation
var z = 0; // defines what happens to the num (+,-,/,*) 'OPERATION'
/*
0=nothing, 1 = add, 2 = subtract, 3 = times, 4 = divide, 5 = equal, 6 = clear
*/
var butSymbols = ["1","2","3","+","4","5","6","-","7","8","9","ร","Clear", "0" ,"=","รท" ];
var butValues = [1,2,3,"+",4,5,6,"-",7,8,9,"*","Clear",0,"=","รท"];/*keep symbols so it lines up with the other array*/
var calcButtons = [];//where the buttons are stored and called from
var numInput = [];//individual digits pushed by clicking numbers
var valuesOfInput = [];//the full numbers which will be used in equation
var answer = null;
var pastAnswer = 0;//allows memory of the previous answer
var keepAShown = false;
var keepPastAnswerShown = false;
var defOpColors = {r:129,g:206, b:227}; //default op colors
var wasOpPressed = false;//if true, triggers change in color of op.

for (var i = 0; i <= 3; i++) //creates buttons
{
    for (var j = 0; j <= 3; j++)
    {
        var calculatorButtons = new Button
        ({
            x: 76 + 112 * i,
            y: 115 + 112 * j,
            width: 110,
            height: 110,
            butText: butSymbols[i+j*4],
            color:color(defOpColors.r,defOpColors.g,defOpColors.b),
        });
        calcButtons.push(new Button(calculatorButtons));
    }
}
for (var i = 0; i <= 10; i++)//turns number buttons a color, clear button seperate
{ 
    if (i !== 3)//if not clear button, give gray
    {
        calcButtons[i].color = color(145, 136, 140);
    }
    else//if clear button give orange
    {
        calcButtons[i].color = color(212, 151, 45);
    }
}
var arrayAdd = function(a)//will be used to add up chosen numbers in an array
{
    var sumOfInputs = 0;
    for (var i = 0; i < a.length; i++)
    {
        sumOfInputs = sumOfInputs + a[i];
    }
    return sumOfInputs;
};
var arraySub = function(a) //subtraction function
{
    var difOfInputs = 0;
    for (var i = 0; i < a.length; i++)
    {
        if (i === 0)
        {
            difOfInputs = a[i]-difOfInputs;
        }
        else
        {
            difOfInputs -= a[i];
        }
    }
    return difOfInputs;
};
var arrayMult = function(a)//multiply function
{
    var product = 0;
    for (var i = 0; i < a.length; i++)
    {
        if (i === 0)
        {
            product = a[i];
        }
        else 
        {
            product *= a[i];
        }
    }
    return product;
};
var arrayDiv = function(a)// dividing function
{
    var quotient = 0;
    for (var i = 0; i < a.length; i++)
    {
        if (i === 0)
        {
            quotient = a[i];
        }
        else 
        {
            quotient /= a[i];
        }
    }
    return quotient;
};
var arrayCombineIntoNum = function(a)//each button pushs individual digits into array. they are the put into 1 number using this function EX: [4,5,3,5] --> 4,535
{
    var finalNum = 0;
    var tens = 10;
    for (var i = a.length-1; i >= 0; i--)//starts at the end of array given
    {
        if (i === a.length-1)// if its the last num in the array, it gets the ones place
        {
            finalNum = a[i];
        }
        else 
        /*the digits before the last one are multiplied by ten, or a squared 10 to be put
        into the coorisponding numbers place, as our numbers are a base of ten */
        {
            finalNum = finalNum + a[i]*tens;
            tens *= 10;
        }
    }
    return finalNum;
};
mouseClicked = function()//mouseclicked function
{
    for (var i = 0; i < calcButtons.length; i++)
    {
        calcButtons[i].handleMouseClick();
    }
};

var numButFunction = function(bIndex,bValue)//ADD MORE COMMENTS
{
    wasOpPressed = false;//resets the darkop buttons
    keepAShown = false;//takes away so it can display whats typed
    keepPastAnswerShown = false;//same as y keepAshown gets false
    answer = null;
    if (z === 0 && pastAnswer !== 0)
    {
        pastAnswer = 0;
    }/*if no operator is active, but there is a pastAnswer, reset pastAnswer to 0, because these are the number buttons, past answer only matters when an op is pressed right after "=" is pressed */
    
    if (z === 0 && pastAnswer === 0) 
    {
        if (a === 0)
        {
            a = calcButtons[bIndex].butText;
            numInput.push(bValue);
        } 
        else if (a !== 0)
        {
            a = a + calcButtons[bIndex].butText;
            numInput.push(bValue);
        }
    }/*if an operator has not been pressed, and theres no
    pastAnswer, meaning its the first time running, or clear was
    pressed, 2 things can then happen. if variable a hasnt been set
    to anything, a will become the text displayed, while also
    pushing the numerical value of whatever text it is, into
    another array to be used later. if a isnt 0, a adds on the
    symbol of the next # button pressed, and pushing a new
    numerical value into array. the combine into number function 
    takes that seperate array to get the full number*/
    else if (z === 0 && pastAnswer !== 0)
    {
        a = pastAnswer;
        if (b === 0)
        {
            b = calcButtons[bIndex].butText;
            numInput.push(bValue);
        } 
        else if (b !== 0)
        {
            b = b + calcButtons[bIndex].butText;
            numInput.push(bValue);
        }
    } /* same conditional as the first in this function, but after
    a has been declared by the user, the next set of numbers in a
    mathematical function are going to be the variable b. */
    else if (z > 0)
    {
        if (b === 0)
        {
            b = calcButtons[bIndex].butText;
            numInput.push(bValue);
        } 
        else if (b !== 0)
        {
            b = b + calcButtons[bIndex].butText;
            numInput.push(bValue);
        }
    }/* if z isnt 0, meaning an operator is active, the number pressed will go to b, as variable a is already filled*/
};
calcButtons[0].onClick = function() // "1" button
{
    numButFunction(0,1);
};
calcButtons[1].onClick = function() // "4" button
{
    numButFunction(1,4);
};
calcButtons[2].onClick = function() // "7" button
{
    numButFunction(2,7);
};
calcButtons[3].onClick = function() // "Clear" button
{
    numInput = [];//resets
    valuesOfInput = [];//resets
    pastAnswer = 0;//resets
    answer = null;//resets
    a = 0;//resets
    b = 0;//resets
    z = 0;//resets
    keepPastAnswerShown = false;//resets
    keepAShown = false;//resets
    wasOpPressed = false;//resets
};
calcButtons[4].onClick = function() // "2" button
{
    numButFunction(4,2);
};
calcButtons[5].onClick = function() // "5" button
{
    numButFunction(5,5);
};
calcButtons[6].onClick = function() // "8" button
{
    numButFunction(6,8);
};
calcButtons[7].onClick = function() // "0" button
{
    numButFunction(7,0);
};
calcButtons[8].onClick = function() // "3" button
{
    numButFunction(8,3);
};
calcButtons[9].onClick = function() // "6" button
{
    numButFunction(9,6);
};
calcButtons[10].onClick = function() // "9" button
{
    numButFunction(10,9);
};
calcButtons[11].onClick = function() // "=" button
{
    var runOp = function(opFunction)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        a = 0;
        b = 0;
        z = 0;
        numInput = [];
        answer = opFunction(valuesOfInput);
        pastAnswer = answer;
        valuesOfInput = [];
    };
    /* this function resets a,b,z, numInput[], valuesOfInput[],sets answer pastanswer, and also calls the correct op to use with the numbers*/
    wasOpPressed = true;
    if (z === 0)
    {
        //empty, nothing needs to happen
    }
    else if (z === 1)
    {
        runOp(arrayAdd);//adds values of inputs together
    }
    else if (z === 2)
    {
        runOp(arraySub);//subtracts values of inputs
    }
    else if (z === 3)
    {
        runOp(arrayMult);//multiplys values of inputs
    }
    else if (z === 4)
    {
        runOp(arrayDiv);//divides values of inputs
    }
};
calcButtons[12].onClick = function() // "+" button
{
    wasOpPressed = true;//allows color change
    if (z === 0 && pastAnswer !== 0)
    {
        valuesOfInput.push(pastAnswer);
        numInput = [];
        a = 0;
        z = 1;
        answer = null;
        keepPastAnswerShown = true;
    }/*after "=" pressed, theres a past answer is pushed to values
    of input*/
    else if (z === 0)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        numInput = [];
        a = 0;
        z = 1;
        answer = null;
        keepAShown = true;
    }/* pushes numInput through combineIntoNum, pushing that into
    values of input, sets z=1 to tell that their abt to add, keeps
    a shown so user can see it */
    else if (z === 1)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        numInput = [];
        b = 0;
        a = 0;
        answer = null;
    }
};
calcButtons[13].onClick = function() // "-" button
{
    //if equals was pressed, then a operator is pressed, it uses the past answer
    wasOpPressed = true;
    if (z === 0 && pastAnswer !== 0) // 
    {
        valuesOfInput.push(pastAnswer);
        numInput = [];
        a = 0;
        z = 2;
        answer = null;
        keepPastAnswerShown = true;
    }
    else if (z === 0)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        numInput = [];
        a = 0;
        z = 2;
        answer = null;
        keepAShown = true;
    }
    else if (z === 2)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        numInput = [];
        b = 0;
        a = 0;
        answer = null;
    }
};
calcButtons[14].onClick = function() // "X" button
{
    wasOpPressed = true;
    if (z === 0 && pastAnswer !== 0)
    {
        valuesOfInput.push(pastAnswer);
        numInput = [];
        a = 0;
        z = 3;
        answer = null;
        keepPastAnswerShown = true;
    }
    else if (z === 0)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        //println(valuesOfInput[0]);
        numInput = [];
        a = 0;
        z = 3;
        answer = null;
        keepAShown = true;
    }
    else if (z === 3)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        numInput = [];
        b = 0;
        a = 0;
        answer = null;
    }
};
calcButtons[15].onClick = function() // "Divide" button
{
    wasOpPressed = true;
    if (z === 0 && pastAnswer !== 0)
    {
        valuesOfInput.push(pastAnswer);
        numInput = [];
        a = 0;
        z = 4;
        answer = null;
        keepPastAnswerShown = true;
    }
    else if (z === 0)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        //println(valuesOfInput[0]);
        numInput = [];
        a = 0;
        z = 4;
        answer = null;
        keepAShown = true;
    }
    else if (z === 4)
    {
        valuesOfInput.push(arrayCombineIntoNum(numInput));
        numInput = [];
        b = 0;
        a = 0;
        answer = null;
    }
};
var calcNumDisplay = function(x,y)
{
    var displayWhat;
    var sNotation = function (num)
    {
        if (num <= 10000000)
        {
            return num;
        }
        else if (num > 10000000)
        {
            return num.toExponential();
        }
    }; //numbers larger than 10 mil turned to scientific notation
    
    if (answer !== null)
    {
        displayWhat = sNotation(answer);
    }
    if ( a !== 0 )
    {
        displayWhat = a;
    }
    else if (b !== 0)
    {
        displayWhat = b;
    }
    
    if (keepAShown === true)
    {
        text(valuesOfInput, x , y);
    }
    else if (keepPastAnswerShown === true)//turned on from = button
    {
        text(pastAnswer, x , y);
    }
    else
    {
        text(displayWhat, x , y);
    }
    
};

var changeOpColor = function ()//changes the color of the op buttons so user can remeber which they chose
{
    var whichOpPressed = function(index)
    {
        calcButtons[index].color = color
        (
            defOpColors.r-50,
            defOpColors.g-50,
            defOpColors.b-50
        ); //darkens color
        calcButtons[11].color = color
        (
            defOpColors.r,
            defOpColors.g,
            defOpColors.b
        );//makes sure "=" goes back to normal
    };//darkens colors, resets "=" color
    if (wasOpPressed === true)
    {
        if (z === 0)// "=" pressed
        {
            calcButtons[11].color = color
            (
                defOpColors.r-50,
                defOpColors.g-50,
                defOpColors.b-50
            );
        }
        else if (z === 1)
        {
            whichOpPressed(12);
        }
        else if (z === 2)
        {
            whichOpPressed(13);
        }
        else if (z === 3)
        {
            whichOpPressed(14);
        }
        else if (z === 4)
        {
            whichOpPressed(15);
        }
    }
    else //changes it back 
    {
        for (var i = 11; i <= 15; i++)
        {
            calcButtons[i].color = color
            (
                defOpColors.r,
                defOpColors.g,
                defOpColors.b
            );
        }
    }
};
draw = function() 
{
    strokeWeight(5);//adds lines around everything
    fill(120, 4, 4);//red background color
    rect(2, 2, 595,595);//background square so black border shows
    for (var i = 0; i < calcButtons.length; i++)
    {
        calcButtons[i].draw();
    }//draws buttons
    fill(79, 75, 75);// dark grey color for answer box
    rect(79,10,440,76);//answer box
    textSize(20);
    fill(255, 255, 255);//white text color
    textAlign(RIGHT,CENTER);//makes text appear like a calc
    calcNumDisplay(508,47);//displays what needs to be shown(x,y)
    changeOpColor();//function for changing the op color 
};
